# ‚úÖ Telegram NFT Integration - Ready to Configure!

## What We've Built

I've updated the `NFTService` to properly handle:
- ‚úÖ **Authentication** - Logs in with bot avatar credentials
- ‚úÖ **Provider Activation** - Activates SolanaOASIS + MongoDBOASIS
- ‚úÖ **JWT Token Management** - Caches and refreshes tokens automatically
- ‚úÖ **Proper Payload Format** - Matches your nft-mint-frontend exactly
- ‚úÖ **Image/JSON Handling** - Uses placeholders or custom URLs

---

## üîë Step 1: Create Bot Avatar (One-Time Setup)

You need **ONE site-wide avatar** that the bot will use for all NFT minting.

### Option A: Use Existing Avatar
If you have `metabricks_admin` or similar:
- Username: `metabricks_admin`  
- Password: (your existing password)
- Avatar ID: (your existing avatar ID)

### Option B: Create New Bot Avatar

Run this **once** on your production server:

```bash
curl -X POST "https://oasisweb4.one/api/avatar" \
  -H "Content-Type: application/json" \
  -d '{
    "Username": "telegram_bot",
    "Email": "bot@experiences.fun",
    "Password": "SecurePassword123!",
    "FirstName": "Telegram",
    "LastName": "Bot"
  }'
```

**Save the response** - you'll get an Avatar ID like: `89d907a8-5859-4171-b6c5-621bfe96930d`

---

## ‚öôÔ∏è Step 2: Update OASIS_DNA.json

Add bot credentials to your `OASIS_DNA.json`:

```json
{
  "TelegramOASIS": {
    "BotToken": "7927576561:AAEFHa3k1t6kj0t6wOu6QtU61KRsNxOoeMo",
    "WebhookUrl": "https://oasisweb4.one/api/telegram/webhook",
    "MongoConnectionString": "mongodb+srv://OASISWEB4:Uppermall1!@oasisweb4.ifxnugb.mongodb.net/?retryWrites=true&w=majority&appName=OASISWeb4",
    "TreasuryWalletAddress": "Be51B1n3m1MCtZYvH8JEX3LnZZwoREyH4rYoyhMrkxJs",
    "RewardTokenMintAddress": "",
    "RewardTokenSymbol": "EXP",
    "SolanaCluster": "devnet",
    
    "BotAvatarUsername": "telegram_bot",
    "BotAvatarPassword": "SecurePassword123!",
    "BotAvatarId": "89d907a8-5859-4171-b6c5-621bfe96930d",
    "NFTApiBaseUrl": "https://oasisweb4.one"
  }
}
```

**Important**: Replace with your actual credentials!

---

## üîß Step 3: Update Startup.cs

The `Startup.cs` needs to read these new config values.

**Find this section** (around line 218-226):

```csharp
// Register NFTService for minting NFTs via OASIS API
services.AddSingleton<NFTService>(provider =>
{
    var logger = provider.GetService<ILogger<NFTService>>();
    var baseUrl = "https://oasisweb4.one"; // Production NFT API
    // For local testing, use: "http://localhost:5000"
    
    return new NFTService(baseUrl, logger);
});
```

**Replace with**:

```csharp
// Register NFTService for minting NFTs via OASIS API
services.AddSingleton<NFTService>(provider =>
{
    var logger = provider.GetService<ILogger<NFTService>>();
    
    // Get bot avatar credentials from OASIS_DNA
    // TODO: These should be loaded from OASIS_DNA.json after OASISBootLoader runs
    // For now, hardcode or read from environment variables
    
    var baseUrl = "https://oasisweb4.one";
    var botUsername = "telegram_bot"; // From OASIS_DNA.json TelegramOASIS.BotAvatarUsername
    var botPassword = "SecurePassword123!"; // From OASIS_DNA.json TelegramOASIS.BotAvatarPassword
    var botAvatarId = Guid.Parse("89d907a8-5859-4171-b6c5-621bfe96930d"); // From OASIS_DNA.json TelegramOASIS.BotAvatarId
    
    return new NFTService(baseUrl, botUsername, botPassword, botAvatarId, logger);
});
```

---

## üß™ Step 4: Test the Full Flow

### Test 1: Authentication (Manual)

```bash
curl -X POST "https://oasisweb4.one/api/avatar/authenticate" \
  -H "Content-Type: application/json" \
  -d '{
    "username": "telegram_bot",
    "password": "SecurePassword123!"
  }'
```

**Expected**: You get a `jwtToken` in the response

### Test 2: Mint NFT from Telegram

```
/mintnft YOUR_SOLANA_WALLET | Test Achievement | My first NFT from Telegram!
```

**What happens**:
1. NFTService authenticates with bot avatar ‚úÖ
2. Registers & activates SolanaOASIS ‚úÖ
3. Registers & activates MongoDBOASIS ‚úÖ
4. Mints NFT with proper payload ‚úÖ
5. Sends NFT to your wallet ‚úÖ
6. Bot confirms in Telegram ‚úÖ

---

## üé® Image & JSON Handling

### For MVP/Testing:
- **Images**: Uses placeholder URLs
- **JSON**: Auto-generated by OASIS API
- **Result**: Simple test NFTs mint successfully

### For Production:
1. **Upload badge designs** to Pinata
2. **Get IPFS URLs**
3. **Pass URLs** to `MintAchievementNFTAsync`:
   ```csharp
   await _nftService.MintAchievementNFTAsync(
       title: "30-Day Champion",
       description: "Completed 30-day challenge",
       recipientWallet: wallet,
       mintedByAvatarId: botAvatarId, // Not used, bot uses its own
       imageUrl: "https://gateway.pinata.cloud/ipfs/QmXXX..."
   );
   ```

---

## üöÄ Quick Start Checklist

- [ ] **Step 1**: Create bot avatar (or use existing)
- [ ] **Step 2**: Update `OASIS_DNA.json` with credentials
- [ ] **Step 3**: Update `Startup.cs` with credentials
- [ ] **Step 4**: Rebuild project: `dotnet build`
- [ ] **Step 5**: Run API: `dotnet run`
- [ ] **Step 6**: Test in Telegram: `/mintnft ...`

---

## üìä Expected Logs

When you run `/mintnft`, you should see:

```
[NFTService] Authenticating bot avatar...
[NFTService] Successfully authenticated
[NFTService] Activating providers...
[NFTService] SolanaOASIS registration failed (may already be registered)
[NFTService] MongoDBOASIS registration failed (may already be registered)
[NFTService] Providers activated successfully
[NFTService] Minting NFT: Test Achievement for wallet 7vXZK...
[NFTService] Payload: { "Title": "Test Achievement", ... }
[NFTService] Calling endpoint: https://oasisweb4.one/api/nft/mint-nft
[NFTService] Response Status: 200
[TelegramBot] NFT minted successfully!
```

---

## üéØ What's Next?

Once this works:
1. **Custom Badge Images** - Upload to Pinata, use IPFS URLs
2. **Auto-Mint on Achievements** - Trigger NFT mints when users complete goals
3. **Group Badges** - Membership NFTs for Metamasons
4. **NFT Gallery** - `/mynfts` command to view collection
5. **Leaderboard NFTs** - Special badges for top performers

---

## ‚ùì Troubleshooting

### "Authentication failed"
- Check bot avatar username/password in OASIS_DNA.json
- Verify avatar exists: `curl https://oasisweb4.one/api/avatar/authenticate -d ...`

### "Provider activation failed"
- Check JWT token is valid
- Try registering/activating providers manually first

### "NFT minting failed"
- Check Solana wallet address is valid (32-44 chars)
- Verify image URL is accessible (or use placeholder)
- Check bot avatar has proper permissions

---

**Ready to mint NFTs from Telegram!** üöÄüé®





