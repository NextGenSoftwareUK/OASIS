<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>DOOM</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { width: 100%; height: 100%; background: #000; }
    #dos-root { width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; }
    #dos-root canvas { max-width: 100%; max-height: 100%; }
    .load-msg { color: #888; font-family: monospace; padding: 1rem; }
    .load-err { color: #c41e1e; }
  </style>
</head>
<body>
  <div id="dos-root"><span class="load-msg">Loading DOOMâ€¦</span></div>
  <script>
    (function () {
      var bundleUrl = '/doom.jsdos';
      var jsDosScript = 'https://v8.js-dos.com/latest/js-dos.js';
      var root = document.getElementById('dos-root');

      function showErr(msg) {
        root.innerHTML = '<span class="load-msg load-err">' + msg + '</span>';
      }

      function runWithDos(DosFn) {
        root.innerHTML = '';
        var canvas = document.createElement('canvas');
        root.appendChild(canvas);
        var runner = DosFn(canvas);
        if (runner && typeof runner.run === 'function') {
          runner.run(bundleUrl).catch(function (e) {
            showErr('Failed to start: ' + (e && e.message ? e.message : e));
            console.error('Dos run error', e);
          });
        } else {
          showErr('Dos() did not return .run(). Check js-dos API.');
        }
      }

      function tryStart() {
        var Dos = window.Dos || window.CiDos || (window.JSDOS && window.JSDOS.Dos);
        if (Dos) {
          runWithDos(Dos);
          return;
        }
        var s = document.createElement('script');
        s.src = jsDosScript;
        s.onload = function () {
          Dos = window.Dos || window.CiDos || (window.JSDOS && window.JSDOS.Dos);
          if (Dos) runWithDos(Dos);
          else showErr('js-dos loaded but Dos not found. Check console.');
        };
        s.onerror = function () {
          showErr('Could not load js-dos. Run the doom-browser server (npm start) and use /doom.jsdos.');
        };
        document.head.appendChild(s);
      }

      tryStart();
    })();
  </script>
</body>
</html>
